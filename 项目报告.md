# PROG2002 Web Development II - 评估 2 项目报告

**学生姓名:** [您的姓名]  
**学号:** [您的学号]  
**提交日期:** [日期]

---

## 1. 项目概述

### 1.1 项目目标
开发一个用于慈善活动管理的动态网站，连接慈善组织与潜在参与者，提供活动查看、搜索和详情展示功能。

### 1.2 使用的技术栈
- **后端:** Node.js + Express.js + MySQL
- **前端:** HTML5 + CSS3 + JavaScript (原生，不使用框架)
- **API:** RESTful架构
- **数据库:** MySQL 8.0

### 1.3 项目范围
本项目实现了评估简报中要求的所有核心功能，包括：
- 数据库设计和实现
- RESTful API开发
- 三个主要页面（首页、搜索页、详情页）
- 动态数据加载和用户交互

---

## 2. 数据库设计与实现

### 2.1 数据库架构设计

#### 2.1.1 设计思路
基于案例研究需求，我设计了三个核心表来支持慈善活动管理系统：

1. **charity_organizations（慈善组织表）**
   - 存储慈善组织的基本信息
   - 包含联系方式和网站信息

2. **event_categories（活动类别表）**
   - 存储不同类型的活动分类
   - 支持活动的分类筛选

3. **charity_events（慈善活动表）**
   - 存储活动的详细信息
   - 通过外键关联组织和类别

#### 2.1.2 表关系
- `charity_events.organization_id` → `charity_organizations.organization_id` (多对一)
- `charity_events.category_id` → `event_categories.category_id` (多对一)

#### 2.1.3 关键设计决策

**索引优化:**
```sql
CREATE INDEX idx_event_date ON charity_events(event_date);
CREATE INDEX idx_event_city ON charity_events(city);
CREATE INDEX idx_event_category ON charity_events(category_id);
```
这些索引提高了按日期、城市和类别搜索的性能。

**状态管理:**
使用 `status` ENUM字段（'upcoming', 'ongoing', 'completed'）和 `is_suspended` BOOLEAN字段来管理活动状态，使首页可以只显示有效活动。

**数据完整性:**
- 使用外键约束确保数据一致性
- 设置NOT NULL约束防止关键字段为空
- 使用DEFAULT值简化数据插入

### 2.2 示例数据

我创建了10个真实感的示例活动，涵盖7个不同类别：
- 慈善晚宴
- 趣味跑
- 无声拍卖
- 慈善音乐会
- 义卖活动
- 公益讲座
- 体育赛事

每个活动包含完整的信息，包括筹款目标、当前进度、参与人数等，使演示更加真实。

### 2.3 数据库连接实现

在 `event_db.js` 中，我使用了连接池来优化性能：

```javascript
const pool = mysql.createPool({
    host: 'localhost',
    user: 'root',
    password: '',
    database: 'charityevents_db',
    waitForConnections: true,
    connectionLimit: 10,
    queueLimit: 0
});
```

**优势:**
- 连接复用，减少连接开销
- 支持并发请求
- 自动连接管理

---

## 3. RESTful API 设计与开发

### 3.1 API架构设计

遵循REST设计原则，我实现了5个主要端点：

| 端点 | 方法 | 功能 | 用途 |
|------|------|------|------|
| `/api/events` | GET | 获取所有活动 | 首页活动列表 |
| `/api/events/:id` | GET | 获取活动详情 | 详情页数据 |
| `/api/categories` | GET | 获取类别列表 | 搜索页筛选 |
| `/api/cities` | GET | 获取城市列表 | 搜索页筛选 |
| `/api/events/search` | GET | 搜索活动 | 搜索页查询 |

### 3.2 设计决策

#### 3.2.1 端点命名
- 使用复数名词（`events`而非`event`）
- 资源层次清晰（`/api/events/:id`）
- 查询参数用于筛选（`?date=&city=&category=`）

#### 3.2.2 响应格式标准化
所有API响应都遵循统一格式：

```json
{
    "success": true,
    "count": 10,
    "data": [...]
}
```

这提供了一致的客户端处理体验。

#### 3.2.3 错误处理
实现了完整的错误处理机制：
- HTTP状态码（404, 500等）
- 错误消息描述
- 服务器日志记录

### 3.3 关键实现

#### 首页数据端点
```javascript
app.get('/api/events', async (req, res) => {
    // 只返回未暂停、即将举行的活动
    WHERE ce.is_suspended = FALSE 
    AND ce.status IN ('upcoming', 'ongoing')
    AND ce.event_date >= CURDATE()
    ORDER BY ce.event_date ASC
});
```

这确保首页只显示相关活动，自动过滤过期和暂停的活动。

#### 搜索端点
支持灵活的筛选组合：
```javascript
app.get('/api/events/search', async (req, res) => {
    const { date, city, category } = req.query;
    // 动态构建WHERE子句
    // 支持单个或多个条件组合
});
```

### 3.4 安全考虑

- 使用参数化查询防止SQL注入
- 启用CORS处理跨域请求
- 验证输入参数
- 错误信息不泄露敏感数据

### 3.5 Postman测试

我使用Postman测试了所有端点，验证了：
- ✅ 正确的响应格式
- ✅ 适当的HTTP状态码
- ✅ 筛选条件正确工作
- ✅ 错误处理正常

---

## 4. 客户端网站开发

### 4.1 首页 (index.html)

#### 4.1.1 设计思路
首页采用经典的着陆页设计，包含：
- 引人注目的横幅（Hero Section）
- 组织使命介绍
- 动态活动展示
- 联系信息

#### 4.1.2 动态数据加载
使用Fetch API从后端获取活动数据：

```javascript
const response = await CharityEventsAPI.getAllEvents();
renderEventCards(response.data, container);
```

#### 4.1.3 DOM操作
动态创建活动卡片，展示关键信息：
- 活动图片
- 名称和描述
- 日期、地点
- 价格
- 类别标签

### 4.2 搜索页 (search.html)

#### 4.2.1 筛选表单设计
提供三种筛选条件：
- **日期筛选:** 使用HTML5日期选择器
- **城市筛选:** 下拉选择框（动态加载选项）
- **类别筛选:** 下拉选择框（动态加载选项）

#### 4.2.2 动态加载筛选选项
页面加载时调用API获取城市和类别：

```javascript
async function loadFilterOptions() {
    const categoriesResponse = await CharityEventsAPI.getCategories();
    populateCategoryFilter(categoriesResponse.data);
    
    const citiesResponse = await CharityEventsAPI.getCities();
    populateCityFilter(citiesResponse.data);
}
```

#### 4.2.3 清除筛选功能（DOM操作演示）
```javascript
function clearFilters() {
    searchForm.reset();  // 清除表单
    resultsContainer.innerHTML = '';  // 清空结果
    initialMessage.style.display = 'block';  // 显示初始提示
}
```

这展示了基本的DOM操作能力。

#### 4.2.4 搜索结果展示
- 显示匹配的活动数量
- 展示应用的筛选条件
- 无结果时显示友好提示
- 错误时显示错误消息

### 4.3 详情页 (details.html)

#### 4.3.1 URL参数传递
通过查询字符串传递活动ID：

```javascript
// 导航到详情页
function viewEventDetails(eventId) {
    window.location.href = `details.html?id=${eventId}`;
}

// 读取URL参数
function getEventIdFromURL() {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get('id');
}
```

#### 4.3.2 完整信息展示
详情页展示活动的所有信息：
- 活动图片和基本信息
- 详细描述
- 时间、地点、地址
- 票价和参与人数
- 筹款目标和进度（可视化进度条）
- 主办组织信息

#### 4.3.3 筹款进度可视化
使用CSS动画展示筹款进度：

```javascript
const percentage = (current / goal) * 100;
progressFill.style.width = `${percentage}%`;
```

进度条颜色根据完成度动态变化（蓝色→黄色→绿色）。

#### 4.3.4 "注册"功能（模态框）
按要求，注册按钮显示"功能建设中"模态框：

```javascript
registerBtn.addEventListener('click', () => {
    modal.style.display = 'flex';
});
```

这展示了事件处理和DOM操作能力。

### 4.4 用户体验设计

#### 4.4.1 响应式设计
使用CSS Grid和Flexbox创建响应式布局：
- 桌面：多列展示
- 平板：两列展示
- 手机：单列展示

#### 4.4.2 加载状态
所有异步操作都显示加载动画，提升用户体验：

```javascript
showLoading('loading');
const data = await fetchData();
hideLoading('loading');
```

#### 4.4.3 错误处理
友好的错误提示和处理：
- 网络错误提示
- 无数据提示
- 404错误处理

### 4.5 代码组织

#### 4.5.1 API封装 (api.js)
创建 `CharityEventsAPI` 类封装所有API调用：
- 统一的请求处理
- 错误处理
- 易于维护和扩展

#### 4.5.2 工具函数
提供通用工具函数：
- `formatDate()` - 日期格式化
- `formatTime()` - 时间格式化
- `formatCurrency()` - 货币格式化
- `showError()` / `hideError()` - 错误显示
- `showLoading()` / `hideLoading()` - 加载状态

---

## 5. 数据流和交互

### 5.1 首页数据流

```
用户访问首页
    ↓
JavaScript加载 (home.js)
    ↓
调用 CharityEventsAPI.getAllEvents()
    ↓
Fetch请求 → GET /api/events
    ↓
Express服务器接收请求
    ↓
查询MySQL数据库
    ↓
返回JSON响应
    ↓
JavaScript接收数据
    ↓
DOM操作：创建活动卡片
    ↓
渲染到页面
```

### 5.2 搜索功能数据流

```
用户选择筛选条件
    ↓
用户点击"搜索活动"
    ↓
表单提交事件触发
    ↓
preventDefault() 阻止默认提交
    ↓
收集表单数据
    ↓
调用 CharityEventsAPI.searchEvents(filters)
    ↓
构建查询参数
    ↓
Fetch请求 → GET /api/events/search?date=...&city=...
    ↓
服务器动态构建SQL查询
    ↓
返回筛选后的结果
    ↓
JavaScript接收并渲染结果
```

### 5.3 详情页数据流

```
用户点击"查看详情"
    ↓
导航到 details.html?id=1
    ↓
JavaScript从URL获取ID
    ↓
调用 CharityEventsAPI.getEventById(id)
    ↓
Fetch请求 → GET /api/events/1
    ↓
服务器查询单个活动详情
    ↓
返回完整活动数据
    ↓
JavaScript填充页面元素
    ↓
显示详情页
```

---

## 6. 挑战与解决方案

### 6.1 日期显示问题
**问题:** MySQL日期在JavaScript中显示时会有时区偏差。

**解决方案:** 在formatDate函数中加1天修正：
```javascript
const day = String(date.getDate() + 1).padStart(2, '0');
```

### 6.2 图片加载失败
**问题:** 外部图片URL可能失效。

**解决方案:** 使用onerror处理：
```javascript
<img src="${imageUrl}" onerror="this.src='占位图URL'">
```

### 6.3 异步数据加载
**问题:** 需要先加载筛选选项再显示表单。

**解决方案:** 使用async/await顺序执行：
```javascript
async function initSearchPage() {
    await loadFilterOptions();  // 先加载选项
    setupEventListeners();       // 再设置监听
}
```

### 6.4 模态框关闭
**问题:** 需要多种方式关闭模态框。

**解决方案:** 实现三种关闭方式：
- 点击关闭按钮
- 点击确定按钮
- 点击模态框外部

---

## 7. 代码质量

### 7.1 代码注释
- 所有函数都有JSDoc注释
- 关键逻辑都有内联注释
- SQL查询有说明性注释

### 7.2 命名规范
- 驼峰命名法（camelCase）
- 语义化命名
- 一致性命名约定

### 7.3 代码结构
- 模块化设计
- 关注点分离
- DRY原则（不重复自己）

---

## 8. 测试与验证

### 8.1 API测试（Postman）
✅ 所有端点都通过测试
✅ 验证了响应格式
✅ 测试了各种筛选组合

### 8.2 浏览器测试
✅ Chrome - 正常工作
✅ Firefox - 正常工作
✅ Edge - 正常工作

### 8.3 响应式测试
✅ 桌面（1920x1080）
✅ 平板（768x1024）
✅ 手机（375x667）

---

## 9. 学习收获

通过本项目，我深入学习和应用了：

1. **数据库设计**
   - 理解了关系型数据库的设计原则
   - 学会了使用外键建立表关系
   - 掌握了索引优化查询性能

2. **RESTful API**
   - 理解了REST架构原则
   - 学会了使用Express创建API
   - 掌握了异步数据库操作

3. **前端开发**
   - 熟练掌握了DOM操作
   - 理解了异步编程（Promise, async/await）
   - 学会了Fetch API进行HTTP请求

4. **全栈集成**
   - 理解了前后端数据交互流程
   - 学会了调试跨域问题
   - 掌握了完整的开发流程

---

## 10. 未来改进方向

如果有更多时间，我会考虑：

1. **性能优化**
   - 实现分页加载
   - 添加数据缓存
   - 图片懒加载

2. **用户体验**
   - 添加动画效果
   - 改进移动端体验
   - 添加搜索建议

3. **功能扩展**
   - 活动收藏功能
   - 社交分享功能
   - 地图集成

---

## 11. GenAI 使用声明

**选择以下之一：**

### 选项A（如果使用了）：
我承认在完成此次评估时使用了生成式人工智能工具。我使用了 [工具名称] 来 [具体用途，如：检查语法、生成CSS布局思路等]。所有核心代码逻辑和设计决策均为本人独立完成。

### 选项B（如果未使用）：
我确认在完成此次评估时，我没有故意使用通用人工智能（GenAI）。所有代码、设计和文档均为本人独立完成。

---

## 12. 参考文献

1. Express.js官方文档 - https://expressjs.com/
2. MySQL官方文档 - https://dev.mysql.com/doc/
3. MDN Web文档 - https://developer.mozilla.org/
4. 课程模块1-4学习材料

---

**声明:** 本报告和项目代码均为本人原创作品，遵守SCU学术诚信政策。

**签名:** [您的签名]  
**日期:** [日期]

